<UserControl x:Class="OutOfOfficeAddin.UI.TaskPaneView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="400"
             Background="White">

    <UserControl.Resources>
        <!-- Label style -->
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,6,0,2"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <!-- Input style -->
        <Style x:Key="InputStyle" TargetType="Control">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Padding" Value="4,2"/>
        </Style>
        <!-- Section separator -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,10,0,4"/>
            <Setter Property="Foreground" Value="#444"/>
        </Style>
        <!-- Button style -->
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="MinWidth" Value="90"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <!-- Busy overlay visibility converter -->
        <BooleanToVisibilityConverter x:Key="BoolVis"/>
    </UserControl.Resources>

    <Grid>
        <!-- Main content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="12,8">

                <!-- ── Title ── -->
                <TextBlock Text="Out of Office" FontSize="16" FontWeight="Bold"
                           Margin="0,0,0,8"/>

                <!-- ── Type ── -->
                <TextBlock Text="Type" Style="{StaticResource LabelStyle}"/>
                <ComboBox ItemsSource="{Binding LeaveTypeItems}"
                          SelectedItem="{Binding SelectedLeaveType, Mode=TwoWay}"
                          DisplayMemberPath="DisplayName"
                          Style="{StaticResource InputStyle}"/>

                <!-- ── Dates ── -->
                <Grid Margin="0,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Start date" Style="{StaticResource LabelStyle}"/>
                        <DatePicker SelectedDate="{Binding StartDate, Mode=TwoWay}"
                                    Style="{StaticResource InputStyle}"/>
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="End date" Style="{StaticResource LabelStyle}"/>
                        <DatePicker SelectedDate="{Binding EndDate, Mode=TwoWay}"
                                    Style="{StaticResource InputStyle}"/>
                    </StackPanel>
                </Grid>

                <!-- ── Subject (auto, read-only) ── -->
                <TextBlock Text="Subject (auto)" Style="{StaticResource LabelStyle}"/>
                <TextBox Text="{Binding Subject, Mode=OneWay}"
                         IsReadOnly="True" Background="#F5F5F5"
                         Style="{StaticResource InputStyle}"/>

                <!-- ── Location ── -->
                <TextBlock Text="Location" Style="{StaticResource LabelStyle}"/>
                <TextBox Text="{Binding Location, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource InputStyle}"/>

                <!-- ── To ── -->
                <TextBlock Text="To" Style="{StaticResource LabelStyle}"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="4"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             Text="{Binding ToText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Semicolon-separated addresses"
                             Style="{StaticResource InputStyle}"/>
                    <Button Grid.Column="2" Content="Add from Address Book"
                            Command="{Binding AddToFromAbCommand}"
                            Style="{StaticResource ActionButton}"/>
                </Grid>

                <!-- ── Cc ── -->
                <TextBlock Text="Cc" Style="{StaticResource LabelStyle}"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="4"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             Text="{Binding CcText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Semicolon-separated addresses"
                             Style="{StaticResource InputStyle}"/>
                    <Button Grid.Column="2" Content="Add from Address Book"
                            Command="{Binding AddCcFromAbCommand}"
                            Style="{StaticResource ActionButton}"/>
                </Grid>

                <!-- ── Auto-reply checkbox ── -->
                <CheckBox Content="Set automatic replies for this period"
                          IsChecked="{Binding SetAutoReplies, Mode=TwoWay}"
                          Margin="0,10,0,4" FontSize="12"/>

                <!-- ── OOF previews (visible when SetAutoReplies is ON) ── -->
                <StackPanel Visibility="{Binding SetAutoReplies, Converter={StaticResource BoolVis}}">
                    <TextBlock Text="Internal message (preview)"
                               Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding InternalMessagePreview, Mode=OneWay}"
                             IsReadOnly="True" Background="#F5F5F5"
                             TextWrapping="Wrap" MinHeight="60" MaxHeight="100"
                             VerticalScrollBarVisibility="Auto"
                             Padding="4,2" FontSize="11"/>

                    <TextBlock Text="External message (preview)"
                               Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding ExternalMessagePreview, Mode=OneWay}"
                             IsReadOnly="True" Background="#F5F5F5"
                             TextWrapping="Wrap" MinHeight="80" MaxHeight="120"
                             VerticalScrollBarVisibility="Auto"
                             Padding="4,2" FontSize="11"/>
                </StackPanel>

                <!-- ── Business Trip section ── -->
                <StackPanel Visibility="{Binding IsBusinessTrip, Converter={StaticResource BoolVis}}">
                    <Separator Margin="0,8"/>
                    <TextBlock Text="Business Trip" Style="{StaticResource SectionHeader}"/>

                    <CheckBox Content="Create and fill allowance Excel"
                              IsChecked="{Binding CreateExcel, Mode=TwoWay}"
                              Margin="0,0,0,6" FontSize="12"/>

                    <TextBlock Text="Excel save folder" Style="{StaticResource LabelStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="4"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding ExcelSaveFolder, Mode=OneWay}"
                                 IsReadOnly="True" Background="#F5F5F5"
                                 Style="{StaticResource InputStyle}"/>
                        <Button Grid.Column="2" Content="Browse…"
                                Command="{Binding BrowseExcelFolderCommand}"
                                Style="{StaticResource ActionButton}"/>
                    </Grid>
                </StackPanel>

                <!-- ── Action buttons ── -->
                <Separator Margin="0,10"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                            Margin="0,0,0,4">
                    <Button Content="Create draft"
                            Command="{Binding CreateDraftCommand}"
                            Style="{StaticResource ActionButton}"
                            Margin="0,0,6,0"/>
                    <Button Content="Send"
                            Command="{Binding SendCommand}"
                            Style="{StaticResource ActionButton}"
                            Background="#0078D4" Foreground="White"
                            Margin="0,0,6,0"/>
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            Style="{StaticResource ActionButton}"/>
                </StackPanel>

                <!-- ── Status / log ── -->
                <Separator Margin="0,6"/>
                <TextBlock Text="Status" Style="{StaticResource LabelStyle}"/>
                <TextBox Text="{Binding StatusLog, Mode=OneWay}"
                         IsReadOnly="True" Background="#F8F8F8"
                         TextWrapping="Wrap" MinHeight="60" MaxHeight="160"
                         VerticalScrollBarVisibility="Auto"
                         Padding="4,2" FontSize="11"
                         Margin="0,0,0,12"/>

            </StackPanel>
        </ScrollViewer>

        <!-- Busy overlay -->
        <Border Background="#80FFFFFF"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolVis}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Processing…" FontSize="14" FontWeight="Bold"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
